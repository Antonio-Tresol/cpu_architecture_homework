import pytest
import riscv32_fp_assembler as fp_assembler


@pytest.mark.parametrize(
    "instruction, expected_encoding",
    [
        ("flw ft0, 4(x10)", "000000000100 01010 010 00000 0000111"),
        ("fsw ft2, 4(x10)", "0000000 00100 01010 010 00010 0100111"),
        ("fadd.s ft1, ft0, ft2, rne", "0000000 00010 00000 000 00001 1000011 000"),
        ("fsub.s ft1, ft0, ft2, rtz", "0000100 00010 00000 000 00001 1000011 001"),
        ("fmul.s ft1, ft0, ft2, rup", "0001000 00010 00000 010 00001 1000011 011"),
        ("fdiv.s ft1, ft0, ft2, rdn", "0001100 00010 00000 011 00001 1000011 010"),
        ("fsqrt.s ft1, ft0, rmm", "0101100 00000 00000 000 00001 1000011 101"),
        ("fsgnj.s ft1, ft0, ft2", "0010000 00010 00000 001 00001 1000011 000"),
        ("fsgnjn.s ft1, ft0, ft2", "0010100 00010 00000 010 00001 1000011 000"),
        ("fsgnjx.s ft1, ft0, ft2", "0011000 00010 00000 011 00001 1000011 000"),
        ("fmin.s ft1, ft0, ft2", "0010100 00010 00000 100 00001 1000011 000"),
        ("fmax.s ft1, ft0, ft2", "0011100 00010 00000 101 00001 1000011 000"),
        ("fcvt.s.w ft1, x10, rne", "0000000 01010 00011 110 00001 1010011 000"),
        ("fcvt.s.wu ft1, x10, rtz", "0000001 01010 00011 111 00001 1010011 001"),
        ("fcvt.w.s ft1, x10, rdn", "0001000 00011 01010 101 00001 1010011 010"),
        ("fcvt.wu.s ft1, x10, rup", "0001001 00011 01010 100 00001 1010011 011"),
        ("fmv.x.w ft1, x10", "0000000 01010 00011 000 00001 1010011 000"),
        ("fmv.w.x x10, ft1", "0000001 01010 00001 001 00010 1010011 000"),
        ("feq.s x10, ft0, ft1", "0100000 00010 00000 010 00010 1010011 000"),
        ("flt.s x10, ft0, ft1", "0100100 00010 00000 001 00010 1010011 000"),
        ("fle.s x10, ft0, ft1", "0101000 00010 00000 000 00010 1010011 000"),
        ("fclass.s x10, ft0", "0111000 00000 00000 111 00010 1010011 000"),
        (
            "fmadd.s ft1, ft0, ft2, ft3, rne",
            "00000 00011 00010 00000 000 00001 000 1000011",
        ),
        (
            "fmsub.s ft1, ft0, ft2, ft3, rtz",
            "00001 00011 00010 00000 001 00001 001 1000011",
        ),
        (
            "fnmadd.s ft1, ft0, ft2, ft3, rup",
            "00010 00011 00010 00000 010 00001 011 1000011",
        ),
        (
            "fnmsub.s ft1, ft0, ft2, ft3, rdn",
            "00011 00011 00010 00000 011 00001 010 1000011",
        ),
    ],
)
def test_binary_encode_rv32f_line(instruction, expected_encoding):
    assert (
        fp_assembler.binary_encode_rv32f_line(instruction, readable=True)
        == expected_encoding
    )
